10 'SAVE"OLED_GRX.BAS
20 SCREEN 2
30 '_IOTPUT("msx/me/pm/cpu/percent",200)
40 BLOAD"MSX0.SC2",S
50 _IOTINIT()
60 _IOTFIND("device/i2c_a",C):PRINTC
70 _IOTFIND("device/i2c_a",A$(0),C)
80 FOR I=0 TO C-1:PRINTA$(I):NEXTI
90 _TURBOON
100 DEFINT A-Z:DIM FT$(12),MM$(7)
110 PT$="device/i2c_a/3C"
120 PRINT "READ FONT DATA"
130 FOR I=0 TO 11:RD$="":
140 FOR K=0 TO 7:FOR J=0 TO 7:READ A$:AA$=CHR$(VAL("&H"+A$))
150 RD$=RD$+AA$:NEXT J:NEXT K
160 FT$(I)=RD$:NEXT I
170 'COMMAND_MODE
180 CM$ = CHR$(&H80)
190 'DATA_MODE
200 DM$ = CHR$(&H40)
210 DF = &HAE 'DISPLAY_OFF
220 DO = &HAF 'DISPLAY_ON
230 MM$(0)="  MainRAM:16Kb"
240 MM$(1)="  MainRAM:32Kb"
250 MM$(2)="  MainRAM:64Kb"
260 MM$(3)=" MainRAM:128Kb"
270 MM$(4)=" MainRAM:256Kb"
280 MM$(5)=" MainRAM:512Kb"
290 MM$(6)=" MainRAM:1024Kb"
1000 '------- MAIN
1010 GOSUB 2000
1020 GOSUB 2130
1030 FOR Y=0 TO 55 STEP 8
1040 R=Y/8:C=0:GOSUB 2210
1050 FOR X=0 TO 127 STEP 32
1060 DT$=""
1065 FOR K=0 TO 3
1070 FOR I=0 TO 7:D=0
1080 FOR L=0 TO 7:A=2^L
1090 C=POINT(K*8+X+I,Y+L):IF C=15 THEN D=D+A
1100 NEXT L
1110 DT$=DT$+CHR$(D)
1120 NEXT I:NEXT K:GOSUB 7000
1130 NEXT X:NEXT Y
1140 R=6:C=0:GOSUB 2210
1150 MI=6:'_IOTGET("conf/ram_size_id",MI)
1160 ST$=MM$(MI):GOSUB 2270
1170 FOR I=0 TO 64:MC$=CHR$(&HD3)+CHR$(I):GOSUB 6000:NEXT I
1180 FOR I=0 TO 6:IF I MOD 2=0 THEN SC=&HA6 ELSE SC=&HA7
1190 GOSUB 5000:NEXT I
1200 GOTO 30000
2000 ' INIT
2010 PRINT "INIT"
2020 MC$=CHR$(&HC8) '[C0]/C8:Vertical drawing direction
2040 MC$=MC$+CHR$(&HA1) '[A0]/A1:Horizontal drawing direction
2050 MC$=MC$+CHR$(&HA8)+CHR$(&H3F) 'Screen Resolution 3F:64Line / 1F:32Line
2060 MC$=MC$+CHR$(&HDA)+CHR$(&H12) '[12]:Sequential / 02:Alternative
2070 MC$=MC$+CHR$(&HD3)+CHR$(&H0) 'Vertical offset
2080 MC$=MC$+CHR$(&H40) 'Vertical drawing start position
2090 MC$=MC$+CHR$(&HA6) 'A7:[A6] Color Inversion or Not
2100 MC$=MC$+CHR$(&H8D)+CHR$(&H14) 'Supply voltage of the OLED panel.Must be set to 14h.
2110 GOSUB 6000
2120 RETURN
2130 'CLEAR
2140 PRINT "CLEAR"
2150 SC=DF:GOSUB 5000
2160 FOR R=0 TO 7:C=0:GOSUB 2210
2170 ST$="                ":GOSUB 2270:NEXT R
2180 R=0:C=0:GOSUB 2210
2190 SC=DO:GOSUB 5000
2200 RETURN
2210 ' OLED SET CURSOR
2220 'PRINT "LOCATE:";C;R
2230 MC$=CHR$(&HB0+R)
2240 MC$=MC$+CHR$(&H0+((8*C)AND15))
2250 MC$=MC$+CHR$(&H10+(((8*C)AND240)AND15)):GOSUB 6000
2260 RETURN
2270 'PUTS
2280 'PRINT "PUTS:";ST$
2290 FOR L=1 TO LEN(ST$):MD$=MID$(ST$,L,1)
2300 C1=ASC(MD$)-32:CC=C1/8:N=C1 MOD 8
2310 DT$=MID$(FT$(CC),N*8+1,8):GOSUB 7000
2320 '_IOTPUT(PT$,BF(C,J))
2330 NEXT L
2340 RETURN
5000 ' SEND COMMAND
5010 'PRINT "SEND COMMAND:";HEX$(ASC(CM$));",";HEX$(SC)
5020 PD$=PT$:PS$=CM$+CHR$(SC):GOSUB 10000
5030 RETURN
6000 ' SEND MULTI COMMAND
6010 'PRINT "SEND MULTICOMMAND:";HEX$(0);",";:FOR G=1 TO LEN(MC$):PRINT HEX$(ASC(MID$(MC$,G,1)));",";:NEXT G:PRINT
6020 PD$=PT$:PS$=CHR$(0)+MC$:GOSUB 10000
6030 RETURN
7000 ' SEND DATA
7010 'PRINT "SEND DATA:";HEX$(ASC(DM$));",";:FOR G=1 TO LEN(DT$):PRINT HEX$(ASC(MID$(DT$,G,1)));",";:NEXT G:PRINT
7020 PD$=PT$:PS$=DM$+DT$:GOSUB 10000
7030 RETURN
10000 '----------IOTPUT S
10010 OUT8,&HE0:OUT8,1:OUT8,&H53
10020 OUT8,&HC0:LN=LEN(PD$):OUT8,LN:FOR II=1TOLN:OUT8,ASC(MID$(PD$,II,1)):NEXTII:OUT8,0:RR=INP(8)
10030 OUT8,&HE0:OUT8,1:OUT8,&H43
10040 OUT8,&HC0:LN=LEN(PS$):OUT8,LN:FOR II=1TOLN:OUT8,ASC(MID$(PS$,II,1)):NEXTII:OUT8,0:RR=INP(8)
10050 RETURN
20000 '----------- BASIC FONT
20010 DATA 00,00,00,00,00,00,00,00
20020 DATA 00,00,5F,00,00,00,00,00
20030 DATA 00,00,07,00,07,00,00,00
20040 DATA 00,14,7F,14,7F,14,00,00
20050 DATA 00,24,2A,7F,2A,12,00,00
20060 DATA 00,23,13,08,64,62,00,00
20070 DATA 00,36,49,55,22,50,00,00
20080 DATA 00,00,05,03,00,00,00,00
20090 DATA 00,1C,22,41,00,00,00,00
20100 DATA 00,41,22,1C,00,00,00,00
20110 DATA 00,08,2A,1C,2A,08,00,00
20120 DATA 00,08,08,3E,08,08,00,00
20130 DATA 00,A0,60,00,00,00,00,00
20140 DATA 00,08,08,08,08,08,00,00
20150 DATA 00,60,60,00,00,00,00,00
20160 DATA 00,20,10,08,04,02,00,00
20170 DATA 00,3E,51,49,45,3E,00,00
20180 DATA 00,00,42,7F,40,00,00,00
20190 DATA 00,62,51,49,49,46,00,00
20200 DATA 00,22,41,49,49,36,00,00
20210 DATA 00,18,14,12,7F,10,00,00
20220 DATA 00,27,45,45,45,39,00,00
20230 DATA 00,3C,4A,49,49,30,00,00
20240 DATA 00,01,71,09,05,03,00,00
20250 DATA 00,36,49,49,49,36,00,00
20260 DATA 00,06,49,49,29,1E,00,00
20270 DATA 00,00,36,36,00,00,00,00
20280 DATA 00,00,AC,6C,00,00,00,00
20290 DATA 00,08,14,22,41,00,00,00
20300 DATA 00,14,14,14,14,14,00,00
20310 DATA 00,41,22,14,08,00,00,00
20320 DATA 00,02,01,51,09,06,00,00
20330 DATA 00,32,49,79,41,3E,00,00
20340 DATA 00,7E,09,09,09,7E,00,00
20350 DATA 00,7F,49,49,49,36,00,00
20360 DATA 00,3E,41,41,41,22,00,00
20370 DATA 00,7F,41,41,22,1C,00,00
20380 DATA 00,7F,49,49,49,41,00,00
20390 DATA 00,7F,09,09,09,01,00,00
20400 DATA 00,3E,41,41,51,72,00,00
20410 DATA 00,7F,08,08,08,7F,00,00
20420 DATA 00,41,7F,41,00,00,00,00
20430 DATA 00,20,40,41,3F,01,00,00
20440 DATA 00,7F,08,14,22,41,00,00
20450 DATA 00,7F,40,40,40,40,00,00
20460 DATA 00,7F,02,0C,02,7F,00,00
20470 DATA 00,7F,04,08,10,7F,00,00
20480 DATA 00,3E,41,41,41,3E,00,00
20490 DATA 00,7F,09,09,09,06,00,00
20500 DATA 00,3E,41,51,21,5E,00,00
20510 DATA 00,7F,09,19,29,46,00,00
20520 DATA 00,26,49,49,49,32,00,00
20530 DATA 00,01,01,7F,01,01,00,00
20540 DATA 00,3F,40,40,40,3F,00,00
20550 DATA 00,1F,20,40,20,1F,00,00
20560 DATA 00,3F,40,38,40,3F,00,00
20570 DATA 00,63,14,08,14,63,00,00
20580 DATA 00,03,04,78,04,03,00,00
20590 DATA 00,61,51,49,45,43,00,00
20600 DATA 00,7F,41,41,00,00,00,00
20610 DATA 00,02,04,08,10,20,00,00
20620 DATA 00,41,41,7F,00,00,00,00
20630 DATA 00,04,02,01,02,04,00,00
20640 DATA 00,80,80,80,80,80,00,00
20650 DATA 00,01,02,04,00,00,00,00
20660 DATA 00,20,54,54,54,78,00,00
20670 DATA 00,7F,48,44,44,38,00,00
20680 DATA 00,38,44,44,28,00,00,00
20690 DATA 00,38,44,44,48,7F,00,00
20700 DATA 00,38,54,54,54,18,00,00
20710 DATA 00,08,7E,09,02,00,00,00
20720 DATA 00,18,A4,A4,A4,7C,00,00
20730 DATA 00,7F,08,04,04,78,00,00
20740 DATA 00,00,7D,00,00,00,00,00
20750 DATA 00,80,84,7D,00,00,00,00
20760 DATA 00,7F,10,28,44,00,00,00
20770 DATA 00,41,7F,40,00,00,00,00
20780 DATA 00,7C,04,18,04,78,00,00
20790 DATA 00,7C,08,04,7C,00,00,00
20800 DATA 00,38,44,44,38,00,00,00
20810 DATA 00,FC,24,24,18,00,00,00
20820 DATA 00,18,24,24,FC,00,00,00
20830 DATA 00,00,7C,08,04,00,00,00
20840 DATA 00,48,54,54,24,00,00,00
20850 DATA 00,04,7F,44,00,00,00,00
20860 DATA 00,3C,40,40,7C,00,00,00
20870 DATA 00,1C,20,40,20,1C,00,00
20880 DATA 00,3C,40,30,40,3C,00,00
20890 DATA 00,44,28,10,28,44,00,00
20900 DATA 00,1C,A0,A0,7C,00,00,00
20910 DATA 00,44,64,54,4C,44,00,00
20920 DATA 00,08,36,41,00,00,00,00
20930 DATA 00,00,7F,00,00,00,00,00
20940 DATA 00,41,36,08,00,00,00,00
20950 DATA 00,02,01,01,02,01,00,00
20960 DATA 00,02,05,05,02,00,00,00
30000 _TURBOOFF
